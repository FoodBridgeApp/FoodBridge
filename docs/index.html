// /docs/fb.js
console.log("[FB] boot");

// ---------------- API base ----------------
const API_BASE = (typeof window !== "undefined" && window.FB_API_BASE)
  ? window.FB_API_BASE.replace(/\/+$/, "")
  : (location.hostname === "localhost"
      ? "http://localhost:10000"
      : "https://foodbridge-server-rv0a.onrender.com");

const API = `${API_BASE}/api`;

// ---------------- helpers ----------------
const $ = (id) => document.getElementById(id);
const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
const esc = (s) => String(s ?? "")
  .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
  .replaceAll('"',"&quot;").replaceAll("'","&#039;");
const setHTML = (el, s="") => { if (el) el.innerHTML = s; };

// Spinner / loader (supports #spinner or #loader)
const _spinner = () => $("spinner") || $("loader");
function showSpinner(){ const s=_spinner(); if(!s) return; s.classList.remove?.("hidden"); s.style.display="block"; }
function hideSpinner(){ const s=_spinner(); if(!s) return; s.classList.add?.("hidden"); s.style.display="none"; }

// ---------------- cart (renders into #cart-items and total span) ----------------
let cart = JSON.parse(localStorage.getItem("fb_cart") || "[]");
function saveCart(){ localStorage.setItem("fb_cart", JSON.stringify(cart)); }
function updateTotal(v=0){ const el=$("checkout-total"); if (el) el.textContent = Number(v||0).toFixed(2); }
function renderCart(){
  const list = $("cart-items");
  if (!list) return;
  if (!cart.length){
    setHTML(list, `<li><em>Your cart is empty.</em></li>`);
    updateTotal(0);
    return;
  }
  setHTML(list, cart.map(i =>
